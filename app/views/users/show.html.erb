<div class="container">
  <div class="row">
    <div class='col-4 offset-1'>
      <h1 class="heading08"><span>User Detail</span>ユーザー情報</h1>
    </div>
      <%= render partial: 'layouts/flash' %>
  </div>
  <div class="row">
   <div class="col-2"></div>
    <div class="col-6">
      <h3>登録情報</h3>
      <% if @user.id == current_user.id %>
      <%= link_to '編集する', edit_user_path(current_user),  class: "btn btn-outline-success" %>
        <table class="table">
          <tr>
            <th>プロフィール画像</th>
            <th><%= attachment_image_tag(@user, :profile_image, height: "150", width: "150", fallback: "no_image.jpg") %></th>
          </tr>
          <tr>
            <th>ニックネーム</th>
            <th><%= @user.nickname %></th>
          </tr>
          <tr>
            <th>氏名</th>
            <th><%= @user.last_name %><%= @user.first_name %></th>
          </tr>
          <tr>
            <th>カナ</th>
            <th><%= @user.last_name_kana %><%= @user.first_name_kana %></th>
          </tr>
          <tr>
            <th>郵便番号</th>
            <th><%= @user.postal_code %></th>
          </tr>
          <tr>
            <th>住所</th>
            <th><%= @user.address %></th>
          </tr>
          <tr>
            <th>電話番号</th>
            <th><%= @user.telephone_number %></th>
          </tr>
          <tr>
            <th>メールアドレス</th>
            <th><%= @user.email %></th>
          </tr>
          <tr>
            <th>自己紹介</th>
            <th><%= @user.profile_comment %></th>
          </tr>
        </table>
      <div class="container">
        <div class="row d-flex justify-content-between">
         <div class="mb-5">
          <h4>予約履歴</h4>
            <%= link_to '一覧を見る', reservations_path, data: {"turbolinks" => false}, class: "btn btn-outline-info" %>
          </div>
          <div class="mb-5">
            <h4>リクエスト履歴</h4>
            <%= link_to '一覧を見る', requests_reservations_path, data: {"turbolinks" => false}, class: "btn btn-outline-info" %>
          </div>
        </div>
       </div>

      <% else %>
        <table class="table">
          <tr>
            <th>プロフィール画像</th>
            <th><%= attachment_image_tag(@user, :profile_image, height: "150", width: "150", fallback: "no_image.jpg") %></th>
          </tr>
          <tr>
            <th>ニックネーム</th>
            <th><%= @user.nickname %></th>
          </tr>
          <tr>
            <th>自己紹介</th>
            <th><%= @user.profile_comment %></th>
          </tr>
        </table>
      <h4>出展一覧</h4>
      <%= link_to '一覧を見る', root_path, data: {"turbolinks" => false}, class: "btn btn-outline-info" %>


      <h2>このユーザーを評価</h2>
      <!--<#%= link_to 'このユーザーを評価する', new_review_path(@user.id), data: {"turbolinks" => false}, class: "btn btn-outline-info" %>-->
        <%= form_with(model: @review, local: true) do |f| %>
          <%= f.hidden_field :evaluation, :value => 'score' %>
          <%= f.hidden_field :reviewer_id, value:current_user.id  %>
          <%= f.hidden_field :reviewed_id, value:@user.id  %>

          <div>
            <%= f.label "コメント(200字まで)" %>
            <%= f.text_field :review_comment %>
          </div>
          <div id="evaluate_stars">
            <label>評価：</label>
          </div>
          <div class="actions">
            <%= f.submit '評価する', class:'btn btn-lg btn-outline-dark'  %>
          </div>
        <% end %>

        <script>
          $('#evaluate_stars').raty({
            size: 36,
            starOn: "<%= asset_path('star-on.png') %>",
            starOff: "<%= asset_path('star-off.png') %>",
            starHalf: "<%= asset_path('star-half.png') %>",
            scoreName: 'review[evaluation]', //登録するモデル名とカラム名を記述
            half: true // star-halfの入力を行う
          });
        </script>

        <%= link_to review_path(@user), class: "m-5" do %>
          <h2 class="text-success">このユーザーの評価</h2>
          <div id="average-review-evaluation" data-score=<%= @average_review %>></div>
          <p><%= @reviews.count %> Reviews</p>
        <% end %>

        <script>
          $('#average-review-evaluation').empty();
          $('#average-review-evaluation').raty({
            readOnly: true,
            path: '/assets/',
            score: function() {
              return $(this).attr('data-score')
            }
          });
        </script>

      <% end %>
    </div>
  </div>
 </div>